---
title: é—œæ–¼æˆ‘å°ˆæ¡ˆè¸©åˆ°é€£ç’°é›·é€™ä»¶äº‹
date: 2021-09-16
updated: 2021-09-18
tags: 
    - laravel
    - laravel-mix
    - webpack
summary: 
    laravel-mix app.js SPA chunk files load fail (due to incorrect path)
---

## ç’°å¢ƒ

- Laravel 7
- Laravel-Mix 6
- webpack 5

## å•é¡Œæè¿°

Laravel å°ˆæ¡ˆä½¿ç”¨ laravel-mix ï¼Œ
å°ˆæ¡ˆæ ¹ç›®éŒ„åœ¨ webserver ä¸‹ä¸¦éæŒ‡åˆ° `/path/to/project/public` ï¼Œ
è€Œæ˜¯ `/path/to/project/` ï¼Œæœ€å¾Œå‰ç«¯ SPA åŠ è¼‰ chunk å¤±æ•—

![Chunk-Load-Error](../assets/images/2021-09-16-chunk-load-err.png)

## æƒ³åˆ°çš„å¹¾ç¨®è§£æ³•èˆ‡å˜—è©¦

å‹¾é¸ç‚ºå˜—è©¦éï¼Œåˆªé™¤ç·šéæ­£è§£

- [x]  ~~ä¸åš extract~~
    > å³ä½¿ä¸åš extractï¼Œvue çµ„ä»¶ä¾ç„¶æ˜¯ç·¨è­¯æˆå„è‡ªç¨ç«‹çš„ .js ç”± vue-router åšå‹•æ…‹è¼‰å…¥

- [x]  vue-router è¨­å®š base
    > é€™å€‹è¦è¨­å®šï¼Œä½†ä¸æ˜¯åŒä¸€å€‹ issue

- [x]  è¿½åŸå§‹ç¢¼ï¼Œ`manifest.js` å¯ä»¥çœ‹åˆ° webpack çš„åŠ è¼‰è·¯å¾‘éŒ¯èª¤
- [x]  ç¿» laravel-mix æ–‡ä»¶ï¼Œ `setPublicPath()`

    > ç„¶å¾Œä½ æœƒçœ‹åˆ°é€™å€‹
    [https://github.com/laravel-mix/laravel-mix/issues/2755](https://github.com/laravel-mix/laravel-mix/issues/2755)

    > Also having the issue while using setPublicPath, this happens in development and production.
    > Chunks are loaded from the root of my app. Any workaround?

    å…¶ä»–ç›¸åŒçš„ issue ä¹Ÿè¢« bot å®šæ™‚é—œé–‰äº†å‘¢ ğŸ¤¨

    æ²’æœ‰ç”¨ï¼Œè®“æˆ‘å€‘ä¾†çœ‹çœ‹ `laravel-mix` åŸå§‹ç¢¼  
    [https://github.com/laravel-mix/laravel-mix/blob/master/src/builder/WebpackConfig.js](https://github.com/laravel-mix/laravel-mix/blob/master/src/builder/WebpackConfig.js)

    å¯ä»¥çœ‹åˆ° `builder/WebpackConfig.js` ä¸­çš„ `buildOutput` æ–¹æ³•ï¼Œ  
    `publicPath: '/` ç„¡æƒ…å®šç¾©ä½ çš„ webpack åŠ è¼‰è·¯å¾‘

    ![laravel-mix webconfig publicPath](../assets/images/2021-09-16-laravel-mix-webconfig.png)

- [x]  é‚£éº¼æˆ‘æƒ³è¾¦æ³•è®“ webpack å‹•æ…‹åŠ è¼‰è·¯å¾‘èƒ½åƒåˆ°è‡ªå®šç¾©å°±è¡Œäº†å§ï¼Ÿ

    > å¤¢æƒ³å¾ˆç¾æ»¿ï¼Œç¾å¯¦å¾ˆéª¨æ„Ÿï¼Ÿ  
    webpack 4 çš„æœ‰ä¸€ç±®ç­  
    webpack 5 èƒ½ç”¨çš„æ’ä»¶åƒ…æœ‰ä¸€æ¬¾ï¼›é‚„å¥½é‚„æœ‰ä¸€æ¬¾  

    [GitHub - note520/webpack-bundle-public-path-plugin: æ”¯æŒwebpack5 åŠ¨æ€æ”¹å˜webpackå¼‚æ­¥è¯·æ±‚ä»£ç å—ï¼ˆchunkè¯·æ±‚å‰ç¼€ï¼‰publicPath è·¯å¾„](https://github.com/note520/webpack-bundle-public-path-plugin)

- [x]  çœ‹äº†åŸå§‹ç¢¼ï¼ŒçŸ­çŸ­çš„åŸå§‹ç¢¼ä½†å®Œå…¨ç¬¦åˆæƒ³æ³•èˆ‡éœ€æ±‚

    ![It's you](../assets/images/pokemon-its-you.png)

    1. å°±æ˜¯è¦åœ¨ webpack ä¸­çš„ä½œç”¨åŸŸèƒ½å¤ è¦†å¯« `__webpack_require__.p`
    2. å°±æ˜¯è¦èƒ½é€šé `window.config` ä¾†å‹•æ…‹ init entry

## é€£ç’°é›·ï¼ŸMurmur

é€™æ•´å€‹äº‹ä»¶çš„èµ·å› æ˜¯

1. testing, development, production çš„ entry ä¸åŒ

    æˆ‘å€‹äºº `testing` ç›´æ¥ nginx æŒ‡åˆ°å°ˆæ¡ˆ public ç›®éŒ„ï¼Œi.e. `https://æ¸¬è©¦ç¶²å€/`  
    å…¶ä»–äºº testing å‰‡æ˜¯æŒ‡åˆ°å°ˆæ¡ˆç›®éŒ„ï¼Œi.e. `https://æ¸¬è©¦ç¶²å€/public`  
    dev ç’°å¢ƒå‰‡æ˜¯ `http://æ¸¬è©¦IP/path/to/å°ˆæ¡ˆ/public`  

    ä½†é€™ä¸èƒ½ç®— `laravel` çš„ bug  
    `laravel` å®˜æ–¹æ–‡ä»¶ä¸€é–‹å§‹å°±è¬›æ˜  
    site root æ‡‰è©²æŒ‡åˆ° `laravel_project/public`  
    å°±æ¸¬è©¦/é–‹ç™¼ç’°å¢ƒçš„ä¸åŒï¼Œæ‰æœƒè¸©åˆ°é›·  

    æˆ‘æƒ³å…¶ä»–å¤¥ä¼´é–‹ç™¼æ™‚éœ€è¦æŒ‡åˆ° public å¯èƒ½æœ‰å…¶ä»–éœ€æ±‚ï¼Œ  
    ç®—äº†å…¥å¢ƒéš¨ä¿—ï¼Œè·¯å¾‘ä¸Šèƒ½è™•ç†é‚„æ˜¯å½ˆæ€§é»è™•ç†æ‰å§

2. Webpack Dynamic Public Path Pluginï¼Œéƒ½æ˜¯æ”¯æ´ Webpack 4 çš„  
   å…¶ä¸­æœ‰ä½¿ç”¨åˆ° Webpack 5 æ£„ç”¨çš„ apiï¼Œæ‰€ä»¥è£å®Œåœ¨ build æ™‚ï¼Œå°±æœƒç„¡æƒ…åœ°æº«é¦¨å ±éŒ¯

3. é€™æ‡‰è©²ä¸ç®—ä½†æ˜¯å·¥ä½œé‡ +1ï¼ŒXD

   å°æ¥ API æ™‚çš„è·¯å¾‘ï¼ŒåŸå…ˆæƒ³èªªå¤§éƒ¨åˆ† API åªæœƒåœ¨å°æ‡‰çš„ vue çµ„ä»¶ä¸­è¢«èª¿ç”¨ï¼Œå°±å·æ‡¶  
   çµæœè·Ÿè·¯å¾‘é›·ä¸€èµ·å°è¸©äº†ï¼Œæœ€å¾Œé‚„æ˜¯æŠŠ API çš„éƒ¨ä»½ç¨ç«‹æ‹†åˆ° `api.js` ä¸­åšç®¡ç†  

   æ€éº¼æ‹†ï¼Ÿæˆ‘æ˜¯é€™å€‹æ•ˆä»¿é€™å€‹æ–¹å¼  
   [ä½¿ç”¨Axiosæ™‚ä½ çš„APIéƒ½æ€éº¼ç®¡ç†ï¼Ÿ](https://medium.com/i-am-mike/%E4%BD%BF%E7%94%A8axios%E6%99%82%E4%BD%A0%E7%9A%84api%E9%83%BD%E6%80%8E%E9%BA%BC%E7%AE%A1%E7%90%86-557d88365619)

## è…¦éœ§æˆ°å£«å›æ†¶éŒ„

```jsx
// global
window.g_config = {
	publicPath: "{{ Request::root() }}/"
}

// vue-router
let spaPath = '/'

if (window.g_config && window.g_config.publicPath) {
    const appUrl = new URL(window.g_config.publicPath)
    spaPath = appUrl.pathname
}

const router = new VueRouter({
    mode: "history",
    base: spaPath,
```

## åƒè€ƒè³‡æ–™èˆ‡å»¶ä¼¸é–±è®€

+ [å…¬å…±è·¯å¾„ | webpack ä¸­æ–‡æ–‡æ¡£](https://webpack.docschina.org/guides/public-path/)
+ [API å‚è€ƒ | Vue Router](https://router.vuejs.org/zh/api/#base)
+ [How can use laravel assets in vue component](https://stackoverflow.com/questions/52576512/how-can-use-laravel-assets-in-vue-component)
+ [Laravel + Vue å‰åå°åˆ†å¼€æ‰“åŒ…è§£å†³æ–¹æ¡ˆ](https://learnku.com/articles/9218/laravel-vue-backstage-package-solution?order_by=created_at&)
+ [å¾ laravel-mix 0.8 å‡ç´šåˆ° 1.4 ç‰ˆçš„è¨˜éŒ„èˆ‡å‘ | Peng Jie's Blog](https://jiepeng.me/2017/08/07/upldate-laravel-mix-from-0-x-1-x)