(window.webpackJsonp=window.webpackJsonp||[]).push([[7],{481:function(t,a,e){t.exports=e.p+"assets/img/2021-09-16-chunk-load-err.655ad239.png"},482:function(t,a,e){t.exports=e.p+"assets/img/2021-09-16-laravel-mix-webconfig.f5deabd5.png"},483:function(t,a,e){t.exports=e.p+"assets/img/pokemon-its-you.0a323068.png"},520:function(t,a,e){"use strict";e.r(a);var r=e(9),s=Object(r.a)({},(function(){var t=this,a=t.$createElement,r=t._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h2",{attrs:{id:"環境"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#環境"}},[t._v("#")]),t._v(" 環境")]),t._v(" "),r("ul",[r("li",[t._v("Laravel 7")]),t._v(" "),r("li",[t._v("Laravel-Mix 6")]),t._v(" "),r("li",[t._v("webpack 5")])]),t._v(" "),r("h2",{attrs:{id:"問題描述"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#問題描述"}},[t._v("#")]),t._v(" 問題描述")]),t._v(" "),r("p",[t._v("Laravel 專案使用 laravel-mix ，\n專案根目錄在 webserver 下並非指到 "),r("code",[t._v("/path/to/project/public")]),t._v(" ，\n而是 "),r("code",[t._v("/path/to/project/")]),t._v(" ，最後前端 SPA 加載 chunk 失敗")]),t._v(" "),r("p",[r("img",{attrs:{src:e(481),alt:"Chunk-Load-Error"}})]),t._v(" "),r("h2",{attrs:{id:"想到的幾種解法與嘗試"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#想到的幾種解法與嘗試"}},[t._v("#")]),t._v(" 想到的幾種解法與嘗試")]),t._v(" "),r("p",[t._v("勾選為嘗試過，刪除線非正解")]),t._v(" "),r("ul",[r("li",[r("p",[t._v("[x]  "),r("s",[t._v("不做 extract")])]),t._v(" "),r("blockquote",[r("p",[t._v("即使不做 extract，vue 組件依然是編譯成各自獨立的 .js 由 vue-router 做動態載入")])])]),t._v(" "),r("li",[r("p",[t._v("[x]  vue-router 設定 base")]),t._v(" "),r("blockquote",[r("p",[t._v("這個要設定，但不是同一個 issue")])])]),t._v(" "),r("li",[r("p",[t._v("[x]  追原始碼，"),r("code",[t._v("manifest.js")]),t._v(" 可以看到 webpack 的加載路徑錯誤")])]),t._v(" "),r("li",[r("p",[t._v("[x]  翻 laravel-mix 文件， "),r("code",[t._v("setPublicPath()")])]),t._v(" "),r("blockquote",[r("p",[t._v("然後你會看到這個\n"),r("a",{attrs:{href:"https://github.com/laravel-mix/laravel-mix/issues/2755",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/laravel-mix/laravel-mix/issues/2755"),r("OutboundLink")],1)])]),t._v(" "),r("blockquote",[r("p",[t._v("Also having the issue while using setPublicPath, this happens in development and production.\nChunks are loaded from the root of my app. Any workaround?")])]),t._v(" "),r("p",[t._v("其他相同的 issue 也被 bot 定時關閉了呢 🤨")]),t._v(" "),r("p",[t._v("沒有用，讓我們來看看 "),r("code",[t._v("laravel-mix")]),t._v(" 原始碼"),r("br"),t._v(" "),r("a",{attrs:{href:"https://github.com/laravel-mix/laravel-mix/blob/master/src/builder/WebpackConfig.js",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://github.com/laravel-mix/laravel-mix/blob/master/src/builder/WebpackConfig.js"),r("OutboundLink")],1)]),t._v(" "),r("p",[t._v("可以看到 "),r("code",[t._v("builder/WebpackConfig.js")]),t._v(" 中的 "),r("code",[t._v("buildOutput")]),t._v(" 方法，"),r("br"),t._v(" "),r("code",[t._v("publicPath: '/")]),t._v(" 無情定義你的 webpack 加載路徑")]),t._v(" "),r("p",[r("img",{attrs:{src:e(482),alt:"laravel-mix webconfig publicPath"}})])]),t._v(" "),r("li",[r("p",[t._v("[x]  那麼我想辦法讓 webpack 動態加載路徑能吃到自定義就行了吧？")]),t._v(" "),r("blockquote",[r("p",[t._v("夢想很美滿，現實很骨感？"),r("br"),t._v("\nwebpack 4 的有一籮筐"),r("br"),t._v("\nwebpack 5 能用的插件僅有一款；還好還有一款")])]),t._v(" "),r("p",[r("a",{attrs:{href:"https://github.com/note520/webpack-bundle-public-path-plugin",target:"_blank",rel:"noopener noreferrer"}},[t._v("GitHub - note520/webpack-bundle-public-path-plugin: 支持webpack5 动态改变webpack异步请求代码块（chunk请求前缀）publicPath 路径"),r("OutboundLink")],1)])]),t._v(" "),r("li",[r("p",[t._v("[x]  看了原始碼，短短的原始碼但完全符合想法與需求")]),t._v(" "),r("p",[r("img",{attrs:{src:e(483),alt:"It's you"}})]),t._v(" "),r("ol",[r("li",[t._v("就是要在 webpack 中的作用域能夠覆寫 "),r("code",[t._v("__webpack_require__.p")])]),t._v(" "),r("li",[t._v("就是要能通過 "),r("code",[t._v("window.config")]),t._v(" 來動態 init entry")])])])]),t._v(" "),r("h2",{attrs:{id:"連環雷-murmur"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#連環雷-murmur"}},[t._v("#")]),t._v(" 連環雷？Murmur")]),t._v(" "),r("p",[t._v("這整個事件的起因是")]),t._v(" "),r("ol",[r("li",[r("p",[t._v("testing, development, production 的 entry 不同")]),t._v(" "),r("p",[t._v("我個人 "),r("code",[t._v("testing")]),t._v(" 直接 nginx 指到專案 public 目錄，i.e. "),r("code",[t._v("https://測試網址/")]),r("br"),t._v("\n其他人 testing 則是指到專案目錄，i.e. "),r("code",[t._v("https://測試網址/public")]),r("br"),t._v("\ndev 環境則是 "),r("code",[t._v("http://測試IP/path/to/專案/public")])]),t._v(" "),r("p",[t._v("但這不能算 "),r("code",[t._v("laravel")]),t._v(" 的 bug"),r("br"),t._v(" "),r("code",[t._v("laravel")]),t._v(" 官方文件一開始就講明"),r("br"),t._v("\nsite root 應該指到 "),r("code",[t._v("laravel_project/public")]),r("br"),t._v("\n就測試/開發環境的不同，才會踩到雷")]),t._v(" "),r("p",[t._v("我想其他夥伴開發時需要指到 public 可能有其他需求，"),r("br"),t._v("\n算了入境隨俗，路徑上能處理還是彈性點處理掉吧")])]),t._v(" "),r("li",[r("p",[t._v("Webpack Dynamic Public Path Plugin，都是支援 Webpack 4 的"),r("br"),t._v("\n其中有使用到 Webpack 5 棄用的 api，所以裝完在 build 時，就會無情地溫馨報錯")])]),t._v(" "),r("li",[r("p",[t._v("這應該不算但是工作量 +1，XD")]),t._v(" "),r("p",[t._v("對接 API 時的路徑，原先想說大部分 API 只會在對應的 vue 組件中被調用，就偷懶"),r("br"),t._v("\n結果跟路徑雷一起小踩了，最後還是把 API 的部份獨立拆到 "),r("code",[t._v("api.js")]),t._v(" 中做管理")]),t._v(" "),r("p",[t._v("怎麼拆？我是這個效仿這個方式"),r("br"),t._v(" "),r("a",{attrs:{href:"https://medium.com/i-am-mike/%E4%BD%BF%E7%94%A8axios%E6%99%82%E4%BD%A0%E7%9A%84api%E9%83%BD%E6%80%8E%E9%BA%BC%E7%AE%A1%E7%90%86-557d88365619",target:"_blank",rel:"noopener noreferrer"}},[t._v("使用Axios時你的API都怎麼管理？"),r("OutboundLink")],1)])])]),t._v(" "),r("h2",{attrs:{id:"腦霧戰士回憶錄"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#腦霧戰士回憶錄"}},[t._v("#")]),t._v(" 腦霧戰士回憶錄")]),t._v(" "),r("div",{staticClass:"language-jsx extra-class"},[r("pre",{pre:!0,attrs:{class:"language-jsx"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// global")]),t._v("\nwindow"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("g_config "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tpublicPath"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{ Request::root() }}/"')]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// vue-router")]),t._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" spaPath "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("g_config "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" window"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("g_config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publicPath"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" appUrl "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("URL")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("window"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("g_config"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("publicPath"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    spaPath "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" appUrl"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname\n"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("VueRouter")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    mode"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"history"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    base"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" spaPath"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),r("h2",{attrs:{id:"參考資料與延伸閱讀"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#參考資料與延伸閱讀"}},[t._v("#")]),t._v(" 參考資料與延伸閱讀")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://webpack.docschina.org/guides/public-path/",target:"_blank",rel:"noopener noreferrer"}},[t._v("公共路径 | webpack 中文文档"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://router.vuejs.org/zh/api/#base",target:"_blank",rel:"noopener noreferrer"}},[t._v("API 参考 | Vue Router"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://stackoverflow.com/questions/52576512/how-can-use-laravel-assets-in-vue-component",target:"_blank",rel:"noopener noreferrer"}},[t._v("How can use laravel assets in vue component"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://learnku.com/articles/9218/laravel-vue-backstage-package-solution?order_by=created_at&",target:"_blank",rel:"noopener noreferrer"}},[t._v("Laravel + Vue 前后台分开打包解决方案"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://jiepeng.me/2017/08/07/upldate-laravel-mix-from-0-x-1-x",target:"_blank",rel:"noopener noreferrer"}},[t._v("從 laravel-mix 0.8 升級到 1.4 版的記錄與坑 | Peng Jie's Blog"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);a.default=s.exports}}]);